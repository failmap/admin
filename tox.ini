[tox]
envlist = check,py34

# default test set runs test suite and fixture integrity checks
[testenv]
basepython = python3
usedevelop = True
deps =
  -rrequirements.txt
  -rrequirements.dev.txt

setenv =
  DJANGO_SETTINGS_MODULE = failmap_admin.settings

commands =
  # check migrations
  failmap-admin migrate
  # ensure fixtures are valid
  failmap-admin load-dataset testdata
  # run testsuite
  coverage run --include 'failmap_admin/*' -m pytest {posargs}
  # generate coverage
  coverage report

# run code quality check
[testenv:check]
commands =
  # make sure code quality is up to par
  pylama failmap_admin tests

# ensure all datasets can be imported
[testenv:datasets]
commands =
    # initialize database
    failmap-admin migrate
    # verify testing dataset
    failmap-admin load-dataset testdata
    # clear database and test other set
    failmap-admin flush --noinput
    failmap-admin load-dataset production_data_10_okt


# utility to perform autofixing of trivial code quality issues
[testenv:autofix]
# install all dependencies so isort knows packages belong where
deps =
    -rrequirements.txt
    -rrequirements.dev.txt
commands =
  autopep8 -ri failmap_admin tests
  isort -rc failmap_admin tests
